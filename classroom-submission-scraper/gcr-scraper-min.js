/**
 * Google Classroom Assignment Submission Scraper v1.2.0
 * Documentation: https://github.com/glenkusuma/script/tree/main/classroom-submission-scraper#readme
 * Created by github.com/glenkusuma
 */
function ScrapeGrade(){return new Promise(e=>{let t=0,r=[],n=!0;!function o(){n&&t<30?(t++,function e(){let t=document.querySelector('span[jscontroller="SIlaZd"]');t.click()}(),setTimeout(()=>{let e={Name:function e(){let t=document.querySelector('div.A39x1.ScX2If.LMgvRb.KKjvXb[jsname="wQNmvb"]');if(!t)return console.log("Parent div for the name not found with the specified class and jsname."),"";let r=t.querySelector("div.UvCNFb.dE51Ic");return r?r.textContent:(console.log("Name div not found within the parent div."),"")}(),ProfileImage:function e(){let t=document.querySelector('div.A39x1.ScX2If.LMgvRb.KKjvXb[jsname="wQNmvb"]');if(!t)return console.log("Parent div for the name not found with the specified class and jsname."),"";let r=t.querySelector("img.sIXQKb.c4pfme.eBPtzb.BTx1Ob");return r?'=IMAGE("'+r.src+'")':(console.log("Image div not found within the parent div."),"")}(),Time:function e(){let t=document.querySelector('[jscontroller="WPsbnb"]');if(!t)return console.log("Element not found with the specified jscontroller attribute for time."),"";let r=t.textContent,n=r.split("Turned in on");return n.length>=2?n[1].trim():"Missing"}(),Grade:function e(){let t=document.querySelector('input[jsname="YPqjbf"]');return t?t.getAttribute("data-initial-value"):(console.log("Grade element not found."),"")}(),AttachedFileNames:function e(){let t=document.querySelector('div[jsname="XkqTFd"]');if(!t)return console.log("Attachment parent div not found with the specified jsname."),"";let r=t.querySelectorAll(".LYKue"),n=[];return r.forEach(e=>{let t=e.textContent;n.push(t)}),n.sort((e,t)=>{let r=e.split(".").pop(),n=t.split(".").pop();return r.localeCompare(n)}),n.join("||")}(),History:function e(){let t=document.querySelector('div[jscontroller="N5Lqpc"]'),r=t.querySelector("table.uLriWc"),n=r.querySelectorAll("tr.CpNN1d"),o="";for(let i=n.length-1;i>=0;i--){let l=n[i],a=l.querySelectorAll("td.MGOEm"),c=Array.from(a).map(e=>e.textContent.trim());o+=`"${c.join('", "')}"`,o+=i>0?";":""}return o}()};(function e(){let t=document.querySelector('div[jscontroller="N5Lqpc"]'),r=t.querySelector('div[jsname="c6xFrd"]').querySelector('div[role="button"]');r.click()})(),console.log("Name:",e.Name),console.log("Time:",e.Time),console.log("Grade:",e.Grade),console.log("History:",e.History),console.log("Attached File Names:",e.AttachedFileNames),r.push(e),n=function e(){let t=document.querySelector('div[jsname="KwmAGc"]');if(!t)return console.log("Button element not found with the specified jsname attribute."),!1;let r=t.getAttribute("aria-disabled");return"true"==r?(console.log("Button is disabled. Exiting the loop."),!1):(setTimeout(()=>{t.click()},1e3),!0)}(),setTimeout(o,1e3)},500)):(console.log("Loop:",t,"has been executed."),e(r))}()})}function convertToCSV(e){if(0===e.length)return console.log("Data Array is empty. Cannot generate CSV."),"";let t=new Set;e.forEach(e=>{let r=e.AttachedFileNames.split("||");r.forEach(e=>{let r=e.split(": ")[0].toLowerCase();r&&t.add(r)})});let r=Array.from(t).sort(),n=["Name","ProfileImage","Time","Grade",...r,"History"],o={};r.forEach((e,t)=>{o[e]=t+4});let i=e.map(e=>{let t=n.map(t=>{if("Name"===t)return e.Name;if("ProfileImage"===t)return e.ProfileImage;if("Time"===t)return e.Time;if("Grade"===t)return e.Grade;if("History"===t)return e.History;let r=t.toLowerCase(),n=e.AttachedFileNames.split("||"),o=n.filter(e=>e.toLowerCase().startsWith(r)).map(e=>e.split(": ")[1]).join("||");return o||""});return t.join(";")}),l=[n.join(";")].concat(i).join("\n");return l}ScrapeGrade().then(e=>{console.log("Data Array:",e);let t=convertToCSV(e);console.log(t)});